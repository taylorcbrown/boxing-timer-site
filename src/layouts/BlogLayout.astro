---
import Layout from './Layout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import type { BlogFrontmatter } from '../content/blog-schema';

export interface Props {
  frontmatter?: BlogFrontmatter;
  title?: string;
  description?: string;
  publishDate?: string;
  updatedDate?: string;
  author?: string;
  heroImage?: string;
  alt?: string;
}

const props = Astro.props;
const fm = props.frontmatter || {} as Partial<BlogFrontmatter>;

// Use frontmatter or direct props with fallbacks
const title = fm.title || props.title || '';
const description = fm.description || props.description || '';
const publishDate = fm.publishDate || props.publishDate || new Date().toISOString();
const updatedDate = fm.updatedDate || props.updatedDate;
const author = fm.author || props.author || "Boxing Timer Champ Team";
const heroImage = fm.heroImage || props.heroImage;
const alt = fm.alt || props.alt;

const formattedPublishDate = new Date(publishDate).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

const formattedUpdatedDate = updatedDate 
  ? new Date(updatedDate).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    })
  : null;
---

<Layout 
  title={title} 
  description={description}
  breadcrumbs={[{ label: 'Blog', href: '/blog' }, { label: title, href: Astro.url.pathname }]}
>
  <div class="max-w-6xl mx-auto px-4">
    {/* Full-width hero image */}
    {heroImage && (
      <div class="mb-8 rounded-lg overflow-hidden shadow-lg">
        <div class="relative pb-[56.25%] w-full overflow-hidden">
          <img 
            src={heroImage} 
            alt={alt || `Featured image for ${title}`} 
            class="absolute inset-0 w-full h-full object-cover object-center"
            width="1600"
            height="900"
            loading="eager"
          />
        </div>
      </div>
    )}
    
    <article class="max-w-3xl mx-auto py-8">
      <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold mb-4">{title}</h1>
        
        <div class="flex flex-wrap items-center text-gray-400 mb-6">
          <span class="mr-4 flex items-center">
            <i class="fas fa-calendar-alt mr-2"></i>
            <time datetime={publishDate} class="text-sm">
              {formattedPublishDate}
            </time>
          </span>
        
        {formattedUpdatedDate && (
          <span class="mr-4 flex items-center">
            <i class="fas fa-edit mr-2"></i>
            <time datetime={updatedDate}>Updated: {formattedUpdatedDate}</time>
          </span>
        )}
        
        <span class="flex items-center">
          <i class="fas fa-user mr-2"></i>
          {author}
        </span>
      </div>
      </header>
      
      <div class="prose prose-invert max-w-none">
        <slot />
      </div>
    </article>

  <script type="application/ld+json" set:html={JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    'headline': title,
    'description': description,
    'image': heroImage,
    'datePublished': publishDate,
    'dateModified': updatedDate || publishDate,
    'author': {
      '@type': 'Person',
      'name': author
    },
    'publisher': {
      '@type': 'Organization',
      'name': 'Boxing Timer Champ',
      'logo': {
        '@type': 'ImageObject',
        'url': `${Astro.site?.origin || 'https://boxingtimerchamp.com'}/favicon.png`
      }
    },
    'mainEntityOfPage': {
      '@type': 'WebPage',
      '@id': Astro.url.href
    }
  })}>
  </script>
  </div>
</Layout>
